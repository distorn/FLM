"use strict";angular.module("FLMClientApp",["FLMClientApp.config","FLMClientApp.auth","FLMClientApp.league","FLMClientApp.team","FLMClientApp.player","FLMClientApp.match","ngMessages","ngSanitize","ngLodash","ui.router","ui.bootstrap","ui.select"]),angular.module("FLMClientApp.auth",["FLMClientApp.utils","LocalStorageModule","ui.router"]),angular.module("FLMClientApp.league",["FLMClientApp.utils","ui.router"]),angular.module("FLMClientApp.match",["FLMClientApp.utils","ui.router"]),angular.module("FLMClientApp.team",["FLMClientApp.utils","ui.router"]),angular.module("FLMClientApp.player",["FLMClientApp.utils","ui.router"]),angular.module("FLMClientApp.utils",[]),function(){function e(e,t,a){t.when("","/league/list"),t.when("/","/league/list"),e.state("error",{templateUrl:"app/layout/error-page.html",params:{title:null,message:null,errorData:null}}),t.otherwise(function(e,t){return e.get("$state").go("error",{title:"404 : Not Found",message:"Requested page not found. Please check the URL."}),t.path}),a.html5Mode(!0)}function t(e,t){e.$on("$stateChangeError",function(e,a,r,n,i,o){var l={toState:a,toParams:r,fromState:n,fromParams:i,response:o};t.go("error",{errorData:l})})}e.$inject=["$stateProvider","$urlRouterProvider","$locationProvider"],t.$inject=["$rootScope","$state"],angular.module("FLMClientApp").config(e).run(t)}(),function(){function e(e,t,a,r,n){function i(e,t){a.set(n.KEY_AUTH_TOKEN,e),a.set(n.KEY_AUTH_ID_TOKEN,t),o()}function o(){var t=a.get(n.KEY_AUTH_TOKEN);if(t){var i=r.getDataFromToken(t);e.user={isAuthorized:!0,isAdmin:i[c]===s,id:i[u],email:i[l]}}else e.user={isAuthorized:!1,isAdmin:!1,id:null,email:null}}var l="email",u="sub",c="role",s="Administrator",m={};return m.resetAuthorizationData=function(){i("","")},m.setAuthorizationData=i,m.updateUserInfo=o,m.getAuthToken=function(){return a.get(n.KEY_AUTH_TOKEN)},m.getAuthIdToken=function(){return a.get(n.KEY_AUTH_ID_TOKEN)},m.getAppURL=function(){return t.protocol()+"://"+t.host()+":"+t.port()},m}e.$inject=["$rootScope","$location","localStorageService","jwtUtils","AUTH"],angular.module("FLMClientApp.auth").factory("appStateService",e)}(),function(){function e(e){e.checkToken()}e.$inject=["securityService"],angular.module("FLMClientApp.auth").config(function(){}).run(e)}(),angular.module("FLMClientApp.auth").constant("AUTH",{KEY_AUTH_TOKEN:"authToken",KEY_AUTH_ID_TOKEN:"authIdToken",KEY_AUTH_NONCE:"authNonce",KEY_AUTH_STATE_CONTROL:"authStateControl"}),function(){function e(e,t){e.state("authorize",{url:"/authorize",templateUrl:"app/auth/authorize.html",controller:"AuthorizeController as ctrl"}).state("logoff",{url:"/logoff",templateUrl:"app/auth/logoff.html",controller:"LogoffController as ctrl"}).state("forbidden",{url:"/forbidden",templateUrl:"app/auth/forbidden.html"}).state("unauthorized",{url:"/unauthorized",templateUrl:"app/auth/unauthorized.html"})}e.$inject=["$stateProvider","$urlRouterProvider"],angular.module("FLMClientApp.auth").config(e)}(),function(){function e(e,t){var a={};return a.request=function(a){a.headers=a.headers||{};var r=t.getAuthToken();return""!==r&&null!=r&&(a.headers.Authorization="Bearer "+r),a||e.when(a)},a.responseError=function(a){return 403===a.status?window.location=t.getAppUrl()+"/forbidden":401===a.status&&t.resetAuthorizationData(),e.reject(a)},a}function t(e){e.interceptors.push("authorizationInterceptor")}e.$inject=["$q","appStateService"],t.$inject=["$httpProvider"],angular.module("FLMClientApp.auth").service("authorizationInterceptor",e).config(t)}(),function(){function e(e){e.doAuthorization()}e.$inject=["securityService"],angular.module("FLMClientApp.auth").controller("AuthorizeController",e)}(),function(){function e(e){console.log("LogoffController created"),e.logoff()}e.$inject=["securityService"],angular.module("FLMClientApp.auth").controller("LogoffController",e)}(),function(){function e(e,t,a,r,n,i,o){var l={};l.doAuthorization=function(){n.resetAuthorizationData(),e.location.hash?c():u()},l.logoff=function(){var t=a.auth.server+"connect/endsession",r=n.getAuthIdToken(),i=n.getAppURL(),o=t+"?id_token_hint="+r+"&post_logout_redirect_uri="+encodeURI(i);n.resetAuthorizationData(),e.location=o},l.checkToken=function(){var e=n.getAuthToken();if(e){var t=i.getDataFromToken(e),a=new Date(1e3*t.exp);a>new Date?n.updateUserInfo():(console.log("Auth token expired: ",a),n.resetAuthorizationData())}};var u=function(){var t=a.auth.server+"connect/authorize",i=a.auth.clientID,l=n.getAppURL()+"/authorize",u=a.auth.requestedScopes.join(" "),c="N"+Math.random()+Date.now(),s=Date.now()+""+Math.random();r.set(o.KEY_AUTH_NONCE,c),r.set(o.KEY_AUTH_STATE_CONTROL,s);var m=t+"?response_type="+encodeURI("id_token token")+"&client_id="+encodeURI(i)+"&redirect_uri="+encodeURI(l)+"&scope="+encodeURI(u)+"&nonce="+encodeURI(c)+"&state="+encodeURI(s);e.location=m},c=function(){var a=e.location.hash.substr(1).split("&").reduce(function(e,t){var a=t.split("=");return e[a[0]]=a[1],e},{}),l="",u="",c=!1;if(!a.error)if(a.state!==r.get(o.KEY_AUTH_STATE_CONTROL))console.log("Auth Callback: incorrect state");else{l=a.access_token,u=a.id_token;i.getDataFromToken(u).nonce!==r.get(o.KEY_AUTH_NONCE)?console.log("Auth Callback: incorrect nonce"):c=!0}c?(n.setAuthorizationData(l,u),t.path("/")):(n.resetAuthorizationData(),t.path(getAppURL()+"/unauthorized"))};return l}e.$inject=["$window","$location","EnvConfig","localStorageService","appStateService","jwtUtils","AUTH"],angular.module("FLMClientApp.auth").factory("securityService",e)}(),function(){function e(e){var t={};return t.errorsList=[],t.lastError=null,t.addError=function(a){t.errorsList.push(a),t.lastError=a,e.$emit("errorRaised",a)},t.hideErrorViews=function(){e.$emit("hideErrorViews")},t.handleApiCallError=function(e){console.error("API Call error: ",e);var a=e.data;null!==a&&void 0!==e.data.errorMessage&&(a=e.data.errorMessage);var r="API Error : "+e.status+" : "+e.statusText+(a?" : "+a:"");t.addError(r)},t}e.$inject=["$rootScope"],angular.module("FLMClientApp").factory("errorLogService",e)}(),function(){function e(e,t,a,r){if(this.errorData=a.errorData,this.detailsVisible=this.errorData&&r.showDebugInfo,a.title)this.title=a.title;else if(this.errorData&&this.errorData.response){var n=this.errorData.response;this.title="Error "+n.status+" : "+n.statusText}else this.title="Error";if(a.message)this.message=a.message;else if(this.errorData&&this.errorData.response&&this.errorData.response.data){var i=this.errorData.response.data;this.message=i.errorMessage}else this.message="Something went wrong.";if(this.errorData&&this.errorData.toState&&this.errorData.toParams){var o=t.href(this.errorData.toState.name,this.errorData.toParams);e.path(o.replace(/^#!/,""))}}e.$inject=["$location","$state","$stateParams","EnvConfig"],angular.module("FLMClientApp").controller("ErrorPageController",e)}(),function(){function e(e){function t(e){r.errorMessage=e,r.visible=!0}function a(){r.visible=!1}var r=this;r.visible=!1,r.errorMessage="",r.showErrorMessage=t,r.hide=a,e.$on("errorRaised",function(e,a){t(a)}),e.$on("hideErrorViews",function(e){a()})}e.$inject=["$rootScope"],angular.module("FLMClientApp").component("errorView",{templateUrl:"app/layout/error-view.html",controller:e})}(),function(){angular.module("FLMClientApp").component("itemAuditView",{templateUrl:"app/layout/item-audit-view.html",bindings:{item:"="},controller:function(){},controllerAs:"ctrl"})}(),function(){function e(e){this.menuItems=[{title:"Leagues",link:"league"},{title:"Teams",link:"team"},{title:"Players",link:"player"},{title:"Matches",link:"match"}],this.isSelected=function(t){var a=e.current.name;return a&&a.startsWith(t.link)}}e.$inject=["$state"],angular.module("FLMClientApp").controller("LayoutController",e)}(),function(){angular.module("FLMClientApp").component("noContentView",{templateUrl:"app/layout/no-content-view.html",controller:function(){}})}(),function(){angular.module("FLMClientApp.league").controller("EditMatchRowController",function(){})}(),function(){function e(e,t,a,r){function n(){t.getRoundSchedule(i.item.id,i.roundNum).then(function(e){e&&(i.matches=e.model)}).catch(a.handleApiCallError)}var i=this;i.item=r,i.leagueTable=[],i.matches=[],i.roundNum=1,i.matchesPerRound=0,i.refreshLeagueTable=function(){t.getStandings(i.item.id).then(function(e){i.leagueTable=e?e.model:[],i.matchesPerRound=Math.floor(i.leagueTable.length/2),i.refreshMatches()}).catch(a.handleApiCallError)},i.refreshMatches=n,i.getMissingMatches=function(){var e=i.matchesPerRound-(i.matches?i.matches.length:0);return new Array(e)},i.deleteItem=function(){t.deleteLeague(i.item.id).then(function(t){e.go("league.list")}).catch(a.handleApiCallError)},i.onRoundChanged=function(){void 0!=i.roundNum&&n()},i.getDisplayName=function(){return t.getDisplayName(i.item)},i.refreshLeagueTable()}e.$inject=["$state","leagueService","errorLogService","dataItem"],angular.module("FLMClientApp.league").controller("LeagueDetailsController",e)}(),function(){function e(e,t,a,r,n,i,o,l){function u(){c.availableTeams=c.leagueTeams,c.formDisabled=!0,c.hasSavedMatches=!1,c.leagueTeams.length>0&&a.getRoundSchedule(c.item.id,c.roundNum).then(function(e){if(e){c.matches=e.model;var t=[];c.formDisabled=c.hasSavedMatches=c.matches.length>0;for(var a=0;a<c.matches.length;a++){var n=c.matches[a];n.team1=c.getTeamById(n.team1Id),t.push(n.team1),n.team2=c.getTeamById(n.team2Id),t.push(n.team2)}var i=Math.floor(c.leagueTeams.length/2);for(a=c.matches.length;a<i;a++){var o=r.newItem();o.leagueId=c.item.id,o.round=c.roundNum,c.matches[a]=o}c.availableTeams=l.difference(c.leagueTeams,t)}}).catch(n.handleApiCallError)}var c=this;c.item=i,c.roundNum=t.roundNum||1,c.noContentFound=!1,c.formDisabled=!1,c.hasSavedMatches=!1,c.leagueTeams=[],c.availableTeams=[],c.matches=[],c.matchDateOptions=o.getDefaultDatePickerOptions(),c.matchDateOptions.minDate=c.item.startDate,c.matchDateOptions.maxDate=c.item.endDate,c.datePickersOpened=[],c.refreshLeagueTeams=function(){c.noContentFound=!1,n.hideErrorViews(),a.getLeagueTeams(c.item.id).then(function(e){e?(c.leagueTeams=e.model,c.leagueTeams&&0===c.leagueTeams.length&&(c.noContentFound=!0)):(c.leagueTeams=[],c.noContentFound=!0),u()}).catch(n.handleApiCallError)},c.refreshMatches=u,c.onTeamAssigned=function(e){e&&l.includes(c.availableTeams,e)&&l.pull(c.availableTeams,e)},c.onTeamRemoved=function(e){l.includes(c.availableTeams,e)||c.availableTeams.push(e)},c.isTeamAssigned=function(e){return!l.includes(c.availableTeams,e)},c.getTeamById=function(e){return l.find(c.leagueTeams,{teamId:e})},c.getDisplayName=function(){return a.getDisplayName(c.item)},c.onEditClick=function(){c.formDisabled=!1},c.onRemoveAllClick=function(){a.clearRoundSchedule(c.item.id,c.roundNum).then(function(e){u()}).catch(n.handleApiCallError)},c.onSaveClick=function(){for(var e=[],t=0;t<c.matches.length;t++){var r=c.matches[t];e.push({leagueId:c.item.id,round:c.roundNum,date:r.date,team1Id:r.team1.teamId,team2Id:r.team2.teamId})}a.editRoundSchedule(c.item.id,c.roundNum,e).then(function(e){c.formDisabled=!0}).catch(n.handleApiCallError)},c.isSavePossible=function(e){for(var t=0;t<c.matchForms.length;t++)if(c.matchForms[t].$invalid)return!1;return!0},c.fixClearFunction=function(e){var t=e.clear;e.clear=function(a){c.onTeamRemoved(e.selected),t.call(e,a)}},c.refreshLeagueTeams()}e.$inject=["$state","$stateParams","leagueService","matchService","errorLogService","dataItem","dateUtils","lodash"],angular.module("FLMClientApp.league").controller("LeagueEditScheduleController",e)}(),function(){function e(e,t,a,r,n){var i=this;i.item=n,i.teamSearchItem=null,i.teamSearchResults=[],i.noContentFound=!1,i.leagueTeams=[],i.refreshTeamSearch=function(e){e&&e.length>0&&a.lookupTeam(e).then(function(e){i.teamSearchResults=e?e.model:[]}).catch(r.handleApiCallError)},i.refreshLeagueTeams=function(){i.noContentFound=!1,r.hideErrorViews(),t.getLeagueTeams(i.item.id).then(function(e){e?(i.leagueTeams=e.model,i.leagueTeams&&0===i.leagueTeams.length&&(i.noContentFound=!0)):(i.leagueTeams=[],i.noContentFound=!0)}).catch(r.handleApiCallError)},i.assignTeam=function(){t.assignTeam(i.item.id,i.teamSearchItem.id,i.teamNumber).then(function(e){i.teamSearchItem=null,i.refreshLeagueTeams()}).catch(r.handleApiCallError)},i.removeTeam=function(e){t.removeTeam(i.item.id,e.teamId).then(function(e){i.refreshLeagueTeams()}).catch(r.handleApiCallError)},i.getDisplayName=function(){return t.getDisplayName(i.item)},i.refreshLeagueTeams()}e.$inject=["$state","leagueService","teamService","errorLogService","dataItem"],angular.module("FLMClientApp.league").controller("LeagueEditTeamsController",e)}(),function(){function e(e,t,a,r,n,i){var o="create",l="edit",u=this;u.mode=i,u.saveBtnText=i===o?"Create":"Save Changes",u.title=i===o?"Create New League":"Edit League",u.item=n,u.leagueTeams=[],u.startDateOptions=r.getDefaultDatePickerOptions(),u.endDateOptions=r.getDefaultDatePickerOptions(),u.save=function(){switch(i){case o:t.createLeague(u.item).then(function(t){u.item=t,e.go("league.list")}).catch(a.handleApiCallError);break;case l:t.editLeague(u.item).then(function(t){u.item=t,e.go("league.list")}).catch(a.handleApiCallError);break;default:console.error("Can't save item. Unknown mode: ",u.mode)}},u.deleteItem=function(){t.deleteLeague(u.item.id).then(function(t){e.go("league.list")}).catch(a.handleApiCallError)},u.refreshLeagueTeams=function(){t.getLeagueTeams(u.item.id).then(function(e){u.leagueTeams=e?e.model:[]}).catch(a.handleApiCallError)},i===l&&u.refreshLeagueTeams()}e.$inject=["$state","leagueService","errorLogService","dateUtils","dataItem","mode"],angular.module("FLMClientApp.league").controller("LeagueEditController",e)}(),function(){function e(e,t,a,r){function n(){a.hideErrorViews(),i.noContentFound=!1,t.getLeagues(i.pagingModel).then(function(e){e?(i.items=e.model,r.updatePagingModel(i.pagingModel,e),i.items&&0===i.items.length&&(i.noContentFound=!0)):(i.items=[],i.noContentFound=!0)}).catch(a.handleApiCallError)}var i=this;i.items=[],i.pagingModel=r.newPagingModel(),i.noContentFound=!1,i.updateList=n,i.deleteItem=function(e){t.deleteLeague(e.id).then(function(e){n()}).catch(a.handleApiCallError)},i.pageChangeHandler=function(){i.updateList()},i.updateList()}e.$inject=["$stateParams","leagueService","errorLogService","pagingUtils"],angular.module("FLMClientApp.league").controller("LeagueListController",e)}(),function(){function e(e,t){t.when("/league","/league/list"),e.state("league",{url:"/league",templateUrl:"app/league/league.html"}).state("league.list",{url:"/list",templateUrl:"app/league/league-list.html",controller:"LeagueListController as ctrl"}).state("league.create",{url:"/create",templateUrl:"app/league/league-edit.html",controller:"LeagueEditController as ctrl",resolve:{dataItem:["leagueService",function(e){return e.newItem()}],mode:function(){return"create"}}}).state("league.edit",{url:"/edit/:itemID",templateUrl:"app/league/league-edit.html",controller:"LeagueEditController as ctrl",resolve:{dataItem:["leagueService","$stateParams",function(e,t){return e.getLeagueById(t.itemID)}],mode:function(){return"edit"}}}).state("league.detail",{url:"/detail/:itemID",templateUrl:"app/league/league-detail.html",controller:"LeagueDetailsController as ctrl",resolve:{dataItem:["leagueService","$stateParams",function(e,t){return e.getLeagueById(t.itemID)}]}}).state("league.edit-teams",{url:"/edit/:itemID/teams",templateUrl:"app/league/league-edit-teams.html",controller:"LeagueEditTeamsController as ctrl",resolve:{dataItem:["leagueService","$stateParams",function(e,t){return e.getLeagueById(t.itemID)}]}}).state("league.edit-schedule",{url:"/edit/:itemID/schedule/:roundNum",templateUrl:"app/league/league-edit-schedule.html",controller:"LeagueEditScheduleController as ctrl",resolve:{dataItem:["leagueService","$stateParams",function(e,t){return e.getLeagueById(t.itemID)}]}})}e.$inject=["$stateProvider","$urlRouterProvider"],angular.module("FLMClientApp.league").config(e)}(),function(){function e(e,t,a,r,n,i){var o={};return o.getLeagues=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r={};return t&&(r.params=i.getParamsFromModel(t)),e.get(a.api+"api/league",r).then(function(e){return e.data})},o.getLeagueById=function(t){return e.get(a.api+"api/league/"+t).then(function(e){var t=e.data.model;return n.convertFields(t,["startDate","endDate"]),t})},o.createLeague=function(t){return e.post(a.api+"api/league",t).then(function(e){return e.data})},o.editLeague=function(t){return e.put(a.api+"api/league",t).then(function(e){return e.data})},o.deleteLeague=function(t){return e.delete(a.api+"api/league/"+t).then(function(e){return e.data})},o.assignTeam=function(t,r){var n="api/league/"+t+"/assign-team/"+r;return e.post(a.api+n).then(function(e){return e.data})},o.removeTeam=function(t,r){var n="api/league/"+t+"/remove-team/"+r;return e.delete(a.api+n).then(function(e){return e.data})},o.getLeagueTeams=function(t){return e.get(a.api+"api/league/"+t+"/teams").then(function(e){return e.data})},o.getRoundSchedule=function(t,r){return e.get(a.api+"api/league/"+t+"/schedule/"+r).then(function(e){if(e.data&&e.data.model){var t=e.data.model;n.convertFields(t,["date"])}return e.data})},o.editRoundSchedule=function(t,r,n){var i={matches:n};return e.post(a.api+"api/league/"+t+"/schedule/"+r,i).then(function(e){return e.data})},o.clearRoundSchedule=function(t,r){return e.delete(a.api+"api/league/"+t+"/schedule/"+r).then(function(e){return e.data})},o.getStandings=function(t){return e.get(a.api+"api/league/"+t+"/standings").then(function(e){return e.data})},o.newItem=function(){return{name:"",season:"",startDate:null,endDate:null,roundsCount:0}},o.getDisplayName=function(e){return e.name+" "+e.season},o}e.$inject=["$http","$q","EnvConfig","errorLogService","dateFieldConverter","pagingUtils"],angular.module("FLMClientApp.league").factory("leagueService",e)}(),function(){function e(e,t,a,r,n){var i=this;i.item=r,i.scores=i.item.scores,i.sortScoresByMinute=function(){i.scores=n.sortBy(i.scores,function(e){return e.minute})},i.getTeamScores=function(e){for(var t=[],a=0;a<i.scores.length;a++){var r=i.scores[a];r.teamId===e&&t.push(r)}return t},i.sortScoresByMinute()}e.$inject=["$state","matchService","errorLogService","dataItem","lodash"],angular.module("FLMClientApp.match").controller("MatchDetailsController",e)}(),function(){function e(e,t,a,r,n,i,o,l){var u=this;u.item=i,u.team1Players=o,u.team2Players=l,u.scores=u.item.scores,u.teams=[{id:u.item.team1Id,label:u.item.team1FullName},{id:u.item.team2Id,label:u.item.team2FullName}],u.scoreInput={},u.getPlayersProvider=function(){return u.scoreInput.team?u.scoreInput.team.id===u.item.team1Id?u.scoreInput.isOG?u.team2Players:u.team1Players:u.scoreInput.isOG?u.team1Players:u.team2Players:[]},u.getPlayerDisplayName=function(e){return e?r.getDisplayName(e):""},u.resetScorePlayer=function(){u.scoreInput.player=null},u.sortScoresByMinute=function(){u.scores=t.sortBy(u.scores,function(e){return e.minute})},u.getTeamScores=function(e){for(var t=[],a=0;a<u.scores.length;a++){var r=u.scores[a];r.teamId===e&&t.push(r)}return t},u.getEnemyTeamId=function(e){return e===u.item.team1Id?u.item.team2Id:e===u.item.team2Id?u.item.team1Id:null},u.addScore=function(){u.scores.push({matchId:u.item.id,teamId:u.scoreInput.team.id,enemyTeamId:u.getEnemyTeamId(u.scoreInput.team.id),playerId:u.scoreInput.player.playerId,playerFullName:r.getDisplayName(u.scoreInput.player),isOG:u.scoreInput.isOG,isPenalty:u.scoreInput.isPenalty,minute:u.scoreInput.minute}),u.sortScoresByMinute(),u.scoreInput={}},u.removeScore=function(e){t.remove(u.scores,function(t){return t==e})},u.isTotalScoresCountValid=function(){return u.scores.length==u.item.team1Score+u.item.team2Score},u.isScoresCountByTeamValid=function(e){return e?u.getTeamScores(u.item.team1Id).length===u.item.team1Score:u.getTeamScores(u.item.team2Id).length===u.item.team2Score},u.isAllScoresValid=function(){return u.isScoresCountByTeamValid(!0)&&u.isScoresCountByTeamValid(!1)},u.save=function(){var e={id:u.item.id,team1Score:u.item.team1Score,team2Score:u.item.team2Score,scores:u.scores};a.editMatch(e).then(function(e){u.item=e.model,u.scores=u.item.scores,u.sortScoresByMinute()}).catch(n.handleApiCallError)},u.sortScoresByMinute()}e.$inject=["$state","lodash","matchService","playerService","errorLogService","dataItem","team1Players","team2Players"],angular.module("FLMClientApp.match").controller("MatchEditController",e)}(),function(){function e(e,t,a,r,n,i,o,l,u){function c(){o.hideErrorViews(),s.noContentFound=!1,r.getMatches(s.pagingModel,s.getFilter()).then(function(e){e?(s.items=e.model,l.updatePagingModel(s.pagingModel,e),s.items&&0===s.items.length&&(s.noContentFound=!0)):(s.items=[],s.noContentFound=!0)}).catch(o.handleApiCallError)}var s=this;if(s.items=[],s.byTeamMode=!1,t){s.tournamentLocked=!1;var m=parseInt(e.leagueID);s.tournaments=[{label:"All Tournaments"}];for(var d=0;d<t.length;d++){var p=t[d],g={label:n.getDisplayName(p),data:p};s.tournaments.push(g),p.id===m&&(s.selectedLeague=g,s.tournamentLocked=!0)}s.selectedLeague||(s.selectedLeague=s.tournaments[0])}else s.byTeamMode=!0,s.teamSearchResults=[],s.selectedTeam=null,s.teamLocked=!1,a&&(s.teamLocked=!0,s.selectedTeam={id:a.id,fullName:i.getDisplayName(a)});s.minDate=null,s.maxDate=null,s.dateOptions=u.getDefaultDatePickerOptions(),s.pagingModel=l.newPagingModel(),s.noContentFound=!1,s.getFilter=function(){var e=r.newFilter();return s.selectedTeam&&(e.teamId=s.selectedTeam.id),s.selectedLeague&&s.selectedLeague.data&&(e.leagueId=s.selectedLeague.data.id),s.minDate&&(s.minDate.setHours(0,0,0,0),e.minDate=s.minDate),s.maxDate&&(s.maxDate.setHours(23,59,59,999),e.maxDate=s.maxDate),e},s.updateList=c,s.deleteItem=function(e){r.deleteMatch(e.id).then(function(e){c()}).catch(o.handleApiCallError)},s.refreshTeamSearch=function(e){e&&e.length>0&&i.lookupTeam(e).then(function(e){s.teamSearchResults=e?e.model:[]}).catch(o.handleApiCallError)},s.pageChangeHandler=function(){s.updateList()},s.updateList()}e.$inject=["$stateParams","leagues","team","matchService","leagueService","teamService","errorLogService","pagingUtils","dateUtils"],angular.module("FLMClientApp.match").controller("MatchListController",e)}(),function(){function e(e,t){t.when("/match","/match/list/by-league/"),e.state("match",{url:"/match",templateUrl:"app/match/match.html"}).state("match.listByLeague",{url:"/list/by-league/:leagueID",templateUrl:"app/match/match-list.html",controller:"MatchListController as ctrl",resolve:{leagues:["leagueService",function(e){return e.getLeagues().then(function(e){return e.model})}],team:function(){return null}}}).state("match.listByTeam",{url:"/list/by-team/:teamID",templateUrl:"app/match/match-list.html",controller:"MatchListController as ctrl",resolve:{leagues:function(){return null},team:["teamService","$stateParams",function(e,t){return t.teamID?e.getTeamById(t.teamID):null}]}}).state("match.edit",{url:"/edit/:itemID",templateUrl:"app/match/match-edit.html",controller:"MatchEditController as ctrl",resolve:{dataItem:["matchService","$stateParams",function(e,t){return e.getMatchById(t.itemID)}],team1Players:["teamService","dataItem",function(e,t){return e.getTeamPlayers(t.team1Id).then(function(e){return e.model})}],team2Players:["teamService","dataItem",function(e,t){return e.getTeamPlayers(t.team2Id).then(function(e){return e.model})}]}}).state("match.detail",{url:"/detail/:itemID",templateUrl:"app/match/match-detail.html",controller:"MatchDetailsController as ctrl",resolve:{dataItem:["matchService","$stateParams",function(e,t){return e.getMatchById(t.itemID)}]}})}e.$inject=["$stateProvider","$urlRouterProvider"],angular.module("FLMClientApp.match").config(e)}(),function(){function e(e,t,a,r,n,i){var o={};return o.getMatches=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n={};return t&&(n.params=i.getParamsFromModel(t)),e.post(a.api+"api/match/search",r,n).then(function(e){return e.data})},o.getMatchById=function(t){return e.get(a.api+"api/match/"+t).then(function(e){var t=e.data.model;return n.convertFields(t,["date"]),t})},o.createMatch=function(t){return e.post(a.api+"api/match",t).then(function(e){return e.data})},o.editMatch=function(t){return e.put(a.api+"api/match",t).then(function(e){return e.data})},o.deleteMatch=function(t){return e.delete(a.api+"api/match/"+t).then(function(e){return e.data})},o.newItem=function(){return{team1Id:null,team2Id:null,date:null}},o.newFilter=function(){return{leagueId:null,teamId:null,minDate:null,maxDate:null}},o.getDisplayName=function(e){return e.firstName+" "+e.lastName},o}e.$inject=["$http","$q","EnvConfig","errorLogService","dateFieldConverter","pagingUtils"],angular.module("FLMClientApp.match").factory("matchService",e)}(),function(){function e(e,t,a,r,n,i){var o=this;o.item=i,o.teamPlayers=[],o.teamLeagues=[],o.deleteItem=function(){t.deleteTeam(o.item.id).then(function(t){e.go("team.list")}).catch(n.handleApiCallError)},o.getDisplayName=function(){return t.getDisplayName(o.item)},o.refreshTeamPlayers=function(){t.getTeamPlayers(o.item.id).then(function(e){o.teamPlayers=e?e.model:[]}).catch(n.handleApiCallError)},o.refreshTeamLeagues=function(){t.getTeamLeagues(o.item.id).then(function(e){o.teamLeagues=e?e.model:[]}).catch(n.handleApiCallError)},o.getPlayerDisplayName=function(e){return e?a.getDisplayName(e):""},o.getLeagueDisplayName=function(e){return e?r.getDisplayName(e):""},o.refreshTeamPlayers(),o.refreshTeamLeagues()}e.$inject=["$state","teamService","playerService","leagueService","errorLogService","dataItem"],angular.module("FLMClientApp.team").controller("TeamDetailsController",e)}(),function(){function e(e,t,a,r,n){var i=this;i.item=n,i.playerSearchItem=null,i.playerSearchResults=[],i.playerNumber=void 0,i.noContentFound=!1,i.teamPlayers=[],i.refreshPlayerSearch=function(e){e&&e.length>0&&a.lookupPlayer(e).then(function(e){i.playerSearchResults=e?e.model:[]}).catch(r.handleApiCallError)},i.refreshTeamPlayers=function(){i.noContentFound=!1,r.hideErrorViews(),t.getTeamPlayers(i.item.id).then(function(e){e?(i.teamPlayers=e.model,i.teamPlayers&&0===i.teamPlayers.length&&(i.noContentFound=!0)):(i.teamPlayers=[],i.noContentFound=!0)}).catch(r.handleApiCallError)},i.assignPlayer=function(){console.log("assignPlayer: ",i.playerSearchItem),t.assignPlayer(i.item.id,i.playerSearchItem.id,i.playerNumber).then(function(e){i.playerSearchItem=null,i.playerNumber=void 0,i.refreshTeamPlayers()}).catch(r.handleApiCallError)},i.removePlayer=function(e){console.log("removePlayer: ",e),t.removePlayer(i.item.id,e.playerId).then(function(e){i.refreshTeamPlayers()}).catch(r.handleApiCallError)},i.getDisplayName=function(){return t.getDisplayName(i.item)},i.getPlayerDisplayName=function(e){return e?a.getDisplayName(e):""},i.refreshTeamPlayers()}e.$inject=["$state","teamService","playerService","errorLogService","dataItem"],angular.module("FLMClientApp.team").controller("TeamEditPlayersController",e)}(),function(){function e(e,t,a,r,n,i,o){var l="create",u="edit",c=this;c.mode=o,c.saveBtnText=o===l?"Create":"Save Changes",c.title=o===l?"Create New Team":"Edit Team",c.item=i,c.teamPlayers=[],c.minYear=1800,c.maxYear=(new Date).getFullYear(),c.refreshTeamPlayers=function(){t.getTeamPlayers(c.item.id).then(function(e){c.teamPlayers=e?e.model:[]}).catch(r.handleApiCallError)},c.getPlayerDisplayName=function(e){return e?a.getDisplayName(e):""},c.save=function(){switch(o){case l:t.createTeam(c.item).then(function(t){c.item=t,e.go("team.list")}).catch(r.handleApiCallError);break;case u:t.editTeam(c.item).then(function(t){c.item=t,e.go("team.list")}).catch(r.handleApiCallError);break;default:console.error("Can't save item. Unknown mode: ",c.mode)}},c.deleteItem=function(){t.deleteTeam(c.item.id).then(function(t){e.go("team.list")}).catch(r.handleApiCallError)},o===u&&c.refreshTeamPlayers()}e.$inject=["$state","teamService","playerService","errorLogService","dateUtils","dataItem","mode"],angular.module("FLMClientApp.team").controller("TeamEditController",e)}(),function(){function e(e,t,a,r){function n(){a.hideErrorViews(),i.noContentFound=!1,t.getTeams(i.pagingModel).then(function(e){e?(i.items=e.model,r.updatePagingModel(i.pagingModel,e),i.items&&0===i.items.length&&(i.noContentFound=!0)):(i.items=[],i.noContentFound=!0)}).catch(a.handleApiCallError)}var i=this;i.items=[],i.pagingModel=r.newPagingModel(),i.noContentFound=!1,i.updateList=n,i.deleteItem=function(e){t.deleteTeam(e.id).then(function(e){n()}).catch(a.handleApiCallError)},i.pageChangeHandler=function(){i.updateList()},i.updateList()}e.$inject=["$stateParams","teamService","errorLogService","pagingUtils"],angular.module("FLMClientApp.team").controller("TeamListController",e)}(),function(){function e(e,t){t.when("/team","/team/list"),e.state("team",{url:"/team",templateUrl:"app/team/team.html"}).state("team.list",{url:"/list",templateUrl:"app/team/team-list.html",controller:"TeamListController as ctrl"}).state("team.detail",{url:"/detail/:itemID",templateUrl:"app/team/team-detail.html",controller:"TeamDetailsController as ctrl",resolve:{dataItem:["teamService","$stateParams",function(e,t){return e.getTeamById(t.itemID)}]}}).state("team.create",{url:"/create",templateUrl:"app/team/team-edit.html",controller:"TeamEditController as ctrl",resolve:{dataItem:["teamService",function(e){return e.newItem()}],mode:function(){return"create"}}}).state("team.edit",{url:"/edit/:itemID",templateUrl:"app/team/team-edit.html",controller:"TeamEditController as ctrl",resolve:{dataItem:["teamService","$stateParams",function(e,t){return e.getTeamById(t.itemID)}],mode:function(){return"edit"}}}).state("team.edit-players",{url:"/edit/:itemID/players",templateUrl:"app/team/team-edit-players.html",controller:"TeamEditPlayersController as ctrl",resolve:{dataItem:["teamService","$stateParams",function(e,t){return e.getTeamById(t.itemID)}]}})}e.$inject=["$stateProvider","$urlRouterProvider"],angular.module("FLMClientApp.team").config(e)}(),function(){function e(e,t,a,r,n,i){var o={};return o.getTeams=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r={};return t&&(r.params=i.getParamsFromModel(t)),e.get(a.api+"api/team",r).then(function(e){return e.data})},o.getTeamById=function(t){return e.get(a.api+"api/team/"+t).then(function(e){return e.data.model})},o.createTeam=function(t){return e.post(a.api+"api/team",t).then(function(e){return e.data})},o.editTeam=function(t){return e.put(a.api+"api/team",t).then(function(e){return e.data})},o.deleteTeam=function(t){return e.delete(a.api+"api/team/"+t).then(function(e){return e.data})},o.assignPlayer=function(t,r,n){var i="api/team/"+t+"/assign-player/"+r+"/"+n;return e.post(a.api+i).then(function(e){return e.data})},o.removePlayer=function(t,r){var n="api/team/"+t+"/remove-player/"+r;return e.delete(a.api+n).then(function(e){return e.data})},o.getTeamPlayers=function(t){return e.get(a.api+"api/team/"+t+"/players").then(function(e){return e.data})},o.getTeamLeagues=function(t){return e.get(a.api+"api/team/"+t+"/leagues").then(function(e){return e.data})},o.lookupTeam=function(t){return e.get(a.api+"api/team/lookup/"+t).then(function(e){return e.data})},o.newItem=function(){return{name:"",city:"",foundationYear:(new Date).getFullYear()}},o.getDisplayName=function(e){return e.city+" "+e.name},o}e.$inject=["$http","$q","EnvConfig","errorLogService","dateFieldConverter","pagingUtils"],angular.module("FLMClientApp.team").factory("teamService",e)}(),function(){function e(e,t,a,r){var n=this;n.item=r,n.deleteItem=function(){t.deletePlayer(n.item.id).then(function(t){e.go("player.list")}).catch(a.handleApiCallError)},n.getDisplayName=function(){return t.getDisplayName(n.item)}}e.$inject=["$state","playerService","errorLogService","dataItem"],angular.module("FLMClientApp.player").controller("PlayerDetailsController",e)}(),function(){function e(e,t,a,r,n,i){var o="create",l="edit",u=this;u.mode=i,u.saveBtnText=i===o?"Create":"Save Changes",u.title=i===o?"Create New Player":"Edit Player",u.item=n,u.dobDateOptions=r.getDefaultDatePickerOptions(),u.dobDateOptions.minDate=new Date(1900,0,1),u.dobDateOptions.maxDate=new Date,u.save=function(){switch(i){case o:t.createPlayer(u.item).then(function(t){u.item=t,e.go("player.list")}).catch(a.handleApiCallError);break;case l:t.editPlayer(u.item).then(function(t){u.item=t,e.go("player.list")}).catch(a.handleApiCallError);break;default:console.error("Can't save item. Unknown mode: ",u.mode)}},u.deleteItem=function(){t.deletePlayer(u.item.id).then(function(t){e.go("player.list")}).catch(a.handleApiCallError)}}e.$inject=["$state","playerService","errorLogService","dateUtils","dataItem","mode"],angular.module("FLMClientApp.player").controller("PlayerEditController",e)}(),function(){function e(e,t,a,r){function n(){a.hideErrorViews(),i.noContentFound=!1,t.getPlayers(i.pagingModel).then(function(e){e?(i.items=e.model,r.updatePagingModel(i.pagingModel,e),i.items&&0===i.items.length&&(i.noContentFound=!0)):(i.items=[],i.noContentFound=!0)}).catch(a.handleApiCallError)}var i=this;i.items=[],i.pagingModel=r.newPagingModel(),i.noContentFound=!1,i.updateList=n,i.deleteItem=function(e){t.deletePlayer(e.id).then(function(e){n()}).catch(a.handleApiCallError)},i.pageChangeHandler=function(){i.updateList()},i.updateList()}e.$inject=["$stateParams","playerService","errorLogService","pagingUtils"],angular.module("FLMClientApp.player").controller("PlayerListController",e)}(),function(){function e(e,t){t.when("/player","/player/list"),e.state("player",{url:"/player",templateUrl:"app/player/player.html"}).state("player.list",{url:"/list",templateUrl:"app/player/player-list.html",controller:"PlayerListController as ctrl"}).state("player.create",{url:"/create",templateUrl:"app/player/player-edit.html",controller:"PlayerEditController as ctrl",resolve:{dataItem:["playerService",function(e){return e.newItem()}],mode:function(){return"create"}}}).state("player.edit",{url:"/edit/:itemID",templateUrl:"app/player/player-edit.html",controller:"PlayerEditController as ctrl",resolve:{dataItem:["playerService","$stateParams",function(e,t){return e.getPlayerById(t.itemID)}],mode:function(){return"edit"}}}).state("player.detail",{url:"/detail/:itemID",templateUrl:"app/player/player-detail.html",controller:"PlayerDetailsController as ctrl",resolve:{dataItem:["playerService","$stateParams",function(e,t){return e.getPlayerById(t.itemID)}]}})}e.$inject=["$stateProvider","$urlRouterProvider"],angular.module("FLMClientApp.player").config(e)}(),function(){function e(e,t,a,r,n,i){var o={};return o.getPlayers=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r={};return t&&(r.params=i.getParamsFromModel(t)),e.get(a.api+"api/player",r).then(function(e){return e.data})},o.getPlayerById=function(t){return e.get(a.api+"api/player/"+t).then(function(e){var t=e.data.model;return n.convertFields(t,["dateOfBirth"]),t})},o.createPlayer=function(t){return e.post(a.api+"api/player",t).then(function(e){return e.data})},o.editPlayer=function(t){return e.put(a.api+"api/player",t).then(function(e){return e.data})},o.deletePlayer=function(t){return e.delete(a.api+"api/player/"+t).then(function(e){return e.data})},o.lookupPlayer=function(t){return e.get(a.api+"api/player/lookup/"+t).then(function(e){return e.data})},o.newItem=function(){return{firstName:"",lastName:"",dateOfBirth:null}},o.getDisplayName=function(e){return e.lastName+" "+e.firstName},o}e.$inject=["$http","$q","EnvConfig","errorLogService","dateFieldConverter","pagingUtils"],angular.module("FLMClientApp.player").factory("playerService",e)}(),function(){function e(e){return e.memoize(e.chunk)}e.$inject=["lodash"],angular.module("FLMClientApp.utils").filter("chunk",e)}(),function(){angular.module("FLMClientApp.utils").factory("dateFieldConverter",function(){var e={};return e.iso8601RegEx=/(19|20|21)\d\d([-/.])(0[1-9]|1[012])\2(0[1-9]|[12][0-9]|3[01])T(\d\d)([:/.])(\d\d)([:/.])(\d\d)/,e.convertField=function(t,a){var r=t[a];if("string"==typeof r&&r.match(e.iso8601RegEx)){var n=new Date(r);t[a]=n}else console.warn("Can't convert field [",a,"] to Date. Item: ",t)},e.convertFields=function(t,a){if(t.constructor===Array)for(var r=0;r<t.length;r++)for(var n=t[r],i=0;i<a.length;i++)e.convertField(n,a[i]);else for(var o=0;o<a.length;o++)e.convertField(t,a[o])},e})}(),function(){angular.module("FLMClientApp.utils").directive("dateMinMaxValidation",function(){var e={};return e.restrict="A",e.require="ngModel",e.link=function(e,t,a,r){var n=e.$eval(a.datepickerOptions);n.minDate&&(r.$validators.minDate=function(e,t){return e>n.minDate}),n.maxDate&&(r.$validators.maxDate=function(e,t){return e<n.maxDate})},e})}(),function(){angular.module("FLMClientApp.utils").factory("dateUtils",function(){var e={};return e.getDefaultDatePickerOptions=function(){return{startingDay:1,showWeeks:!1}},e})}(),function(){angular.module("FLMClientApp.utils").directive("datepickerLocaldate",function(){var e={};return e.restrict="A",e.require="ngModel",e.link=function(e,t,a,r){r.$parsers.push(function(e){return e&&e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),e})},e})}(),function(){function e(e){var t={};return t.getDataFromToken=function(t){var a={};if(void 0!==t){var r=t.split(".")[1];a=JSON.parse(e.urlBase64Decode(r))}return a},t}e.$inject=["stringUtils"],angular.module("FLMClientApp.utils").factory("jwtUtils",e)}(),function(){function e(e){var t={};return t.newPagingModel=function(){return{itemsPerPage:e.defaultItemsPerPage,currentPage:1,totalItems:0}},t.updatePagingModel=function(e,t){e.currentPage=t.pageNumber,e.totalItems=t.itemCount,e.itemsPerPage=t.pageSize},t.getParamsFromModel=function(e){return{pageSize:e.itemsPerPage,pageNumber:e.currentPage}},t}e.$inject=["EnvConfig"],angular.module("FLMClientApp.utils").factory("pagingUtils",e)}(),function(){angular.module("FLMClientApp.utils").factory("stringUtils",function(){var e={};return e.urlBase64Decode=function(e){var t=e.replace("-","+").replace("_","/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}return window.atob(t)},e})}();